<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Pro - Premium Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --card: #161b22;
            --primary: #8b5cf6;
            --accent: #22d3ee;
            --earn-color: #238636;
            --danger: #f85149;
            --text-p: #f0f6fc;
            --text-s: #8b949e;
            --gold: #fbc02d;
            --loan-color: #f97316;
            --toast-bg: rgba(0, 0, 0, 0.9);
            --toast-text: white;
        }

        .light-mode {
            --bg: #f0f2f5;
            --card: #ffffff;
            --primary: #6366f1;
            --accent: #0ea5e9;
            --text-p: #1f2937;
            --text-s: #6b7280;
            --gold: #f59e0b;
            --toast-bg: rgba(255, 255, 255, 0.95);
            --toast-text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text-p);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden; 
            overflow-y: auto; 
            transition: 0.3s;
        }

        .content-area {
            flex: 1;
            overflow-y: visible;
            padding: 20px;
            padding-bottom: 100px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s;
        }

        .active-page {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .summary-card {
            background: linear-gradient(145deg, var(--card), rgba(255, 255, 255, 0.02));
            padding: 18px 12px;
            border-radius: 22px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0;
            width: 4px; height: 100%;
            background: var(--primary);
        }

        .summary-card.month-card::before { background: var(--accent); }

        .summary-card span {
            font-size: 10px;
            color: var(--text-s);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            display: block;
            margin-bottom: 8px;
        }

        .summary-card b {
            font-size: 18px;
            display: block;
            color: var(--text-p);
            font-weight: 800;
        }

        .summary-card b::after {
            content: " TK";
            font-size: 10px;
            opacity: 0.6;
            margin-left: 2px;
        }

        .glass-balance {
            background: linear-gradient(135deg, var(--primary) 0%, #4c1d95 100%);
            padding: 25px;
            border-radius: 24px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .card-box {
            background: var(--card);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 15px;
            position: relative;
        }

        .total-header {
            background: var(--card);
            padding: 18px;
            border-radius: 18px;
            margin-bottom: 15px;
            border-bottom: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            background: var(--bg);
            border: 1px solid var(--text-s);
            border-radius: 12px;
            color: var(--text-p);
            box-sizing: border-box;
            outline: none;
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-main { background: var(--primary); color: white; }

        .txn-card {
            background: var(--card);
            padding: 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            border-left: 4px solid var(--danger);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--card);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-item {
            color: var(--text-s);
            font-size: 8px;
            text-align: center;
            cursor: pointer;
            flex: 1;
        }

        .nav-item.active { color: var(--primary); }

        .toast-container {
            position: fixed;
            bottom: 85px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            pointer-events: none;
        }

        .toast {
            background: var(--toast-bg);
            color: var(--toast-text);
            padding: 12px 25px;
            border-radius: 30px;
            margin-bottom: 10px;
            opacity: 0;
            transform: translateY(20px);
            transition: 0.3s;
        }

        .toast.show { opacity: 1; transform: translateY(0); }

        .mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card);
            width: 38px; height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid var(--text-s);
            z-index: 10;
            font-size: 18px;
        }

        .del-btn { color: var(--danger); font-size: 11px; cursor: pointer; font-weight: bold; }
        .paid-btn { color: var(--earn-color); font-size: 11px; cursor: pointer; font-weight: bold; margin-right: 12px; }

        .alert-box {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-size: 12px;
            display: none;
            text-align: center;
        }

        .profile-section {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(180deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
            border-radius: 24px;
            margin-bottom: 20px;
        }

        .profile-img-container {
            position: relative;
            width: 100px; height: 100px;
            margin: 0 auto;
            cursor: pointer;
        }

        .profile-img-container img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            padding: 3px;
            background: var(--bg);
        }

        .edit-badge {
            position: absolute;
            bottom: 0; right: 0;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 28px; height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid var(--bg);
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(128, 128, 128, 0.1);
        }

        .icon-box {
            width: 35px; height: 35px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        #authScreen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 5000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .hidden { display: none !important; }
    </style>
</head>

<body>

    <div id="authScreen">
        <div class="card-box" style="width: 100%; max-width: 350px; text-align: center;">
            <h2 style="color:var(--primary)">Expense Pro</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button class="btn-main" onclick="handleAuth('login')">Login</button>
            <button onclick="handleAuth('signup')" style="background:transparent; color:var(--accent); margin-top:10px;">Create Account</button>
        </div>
    </div>

    <div id="mainContent" class="hidden">
        <div class="content-area">
            <div class="mode-toggle" onclick="toggleMode()">üåì</div>

            <div id="home" class="page active-page">
                <div style="display:flex; align-items:center; gap: 12px; margin-bottom:20px;">
                    <img id="hPic" src="" style="width:50px; height:50px; border-radius:50%; object-fit:cover; border: 2px solid var(--primary);">
                    <div><span style="font-size:12px; color:var(--text-s);">Welcome back,</span>
                        <h3 id="hName" style="margin:0;">User</h3>
                    </div>
                </div>
                <div id="budgetAlert" class="alert-box">‚ö†Ô∏è Warning: 80% Budget Used!</div>
                <div class="glass-balance">
                    <span style="font-size: 11px; opacity: 0.9;">MONTHLY BUDGET REMAINING</span>
                    <div id="budgetLeft" style="font-size:35px; font-weight:800; margin:10px 0;">0 TK</div>
                    <div style="background:rgba(255,255,255,0.15); border-radius:15px; padding:10px; display: inline-block; min-width: 150px;">
                        <span style="font-size: 10px;">WALLET: <b id="walletTotal">0 TK</b></span>
                    </div>
                </div>

                <div class="summary-grid">
                    <div class="summary-card"><span>Today's Spend</span><b id="todaySpend">0</b></div>
                    <div class="summary-card month-card"><span>Month Spend</span><b id="monthSpend">0</b></div>
                </div>

                <div class="card-box" style="margin-top:20px; height: 260px;">
                    <p style="font-size: 10px; color: var(--text-s); text-align: center; margin-top: 0;">INCOME VS EXPENSE OVERVIEW</p>
                    <canvas id="budgetChart"></canvas>
                </div>
                <div class="card-box">
                    <input type="text" id="exN" placeholder="Expense name"><input type="number" id="exA" placeholder="Amount (TK)">
                    <button class="btn-main" onclick="addEx()">Add Expense</button>
                </div>
            </div>

            <div id="earn" class="page">
                <div class="total-header"><span>Total Earnings</span><h2 id="totalEarnHeader" style="margin:0; color:var(--earn-color)">0 TK</h2></div>
                <div class="card-box">
                    <input type="text" id="eaN" placeholder="Source"><input type="number" id="eaA" placeholder="Amount"><button style="background:var(--earn-color); color:white" onclick="addEa()">Add Income</button>
                </div>
                <div id="earnList"></div>
            </div>
            <div id="loan" class="page">
                <div class="total-header" style="border-bottom-color: var(--loan-color);"><span>Net Loan</span><h2 id="totalLoanHeader" style="margin:0; color:var(--loan-color)">0 TK</h2></div>
                <div class="card-box">
                    <select id="loanType"><option value="given">Given</option><option value="taken">Taken</option></select><input type="text" id="loanPerson" placeholder="Name"><input type="number" id="loanAmount" placeholder="Amount"><button style="background:var(--loan-color); color:white" onclick="addLoan()">Add Loan</button>
                </div>
                <div id="loanList"></div>
            </div>
            <div id="goal" class="page">
                <h2>Goals üéØ</h2>
                <div class="card-box">
                    <input type="text" id="goalN" placeholder="Target Name"><input type="number" id="goalA" placeholder="Goal Amount"><button style="background:var(--gold); color:black" onclick="addGoal()">Set Goal</button>
                </div>
                <div id="goalList"></div>
            </div>
            <div id="hist" class="page">
                <div class="total-header"><span>Total Spent</span><h2 id="totalSpentHeader" style="margin:0; color:var(--danger)">0 TK</h2></div>
                <div id="histList"></div>
            </div>
            <div id="acc" class="page">
                <div class="profile-section">
                    <div class="profile-img-container" onclick="document.getElementById('pInput').click()"><img id="accPic" src="">
                        <div class="edit-badge">üì∏</div>
                    </div>
                    <input type="file" id="pInput" style="display:none" onchange="uploadPic(event)">
                    <h2 id="accDisplayName" style="margin: 15px 0 5px 0;">User Name</h2>
                    <p style="font-size: 12px; color: var(--text-s); margin: 0;">Premium Member</p>
                </div>
                <div class="card-box">
                    <p style="font-size: 11px; color: var(--primary); font-weight: bold; margin-bottom: 10px;">üë§ PERSONAL INFO</p>
                    <input type="text" id="nameIn" placeholder="Enter Name"><button class="btn-main" onclick="saveName()">Save Profile</button>
                </div>
                <div class="card-box">
                    <p style="font-size: 11px; color: var(--accent); font-weight: bold; margin-bottom: 10px;">‚öôÔ∏è ACCOUNT SETTINGS</p>
                    <div class="setting-item">
                        <div class="icon-box" style="background: rgba(34, 211, 238, 0.1); color: var(--accent);">üí∞</div>
                        <div style="flex:1"><small style="color:var(--text-s)">Wallet Balance</small><input type="number" id="mainBalIn" style="margin:0; border:none; padding:5px 0; background:transparent; color:var(--text-p); width:100%;"></div>
                        <button onclick="setMainBal()" style="width:auto; padding:8px 15px; font-size:11px;">Sync</button>
                    </div>
                    <div class="setting-item">
                        <div class="icon-box" style="background: rgba(139, 92, 246, 0.1); color: var(--primary);">üìä</div>
                        <div style="flex:1"><small style="color:var(--text-s)">Monthly Budget</small><input type="number" id="limitIn" style="margin:0; border:none; padding:5px 0; background:transparent; color:var(--text-p); width:100%;"></div>
                        <button onclick="setLimit()" style="width:auto; padding:8px 15px; font-size:11px; background:#334155; color:white;">Set</button>
                    </div>
                </div>
                <div class="card-box">
                    <p style="font-size: 11px; color: var(--earn-color); font-weight: bold; margin-bottom: 10px;">üìÅ DATA & BACKUP</p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                        <button onclick="exportBackup()" style="background:var(--earn-color); color:white; font-size:12px;">üì§ Export</button><button onclick="exportPDF()" style="background:var(--primary); color:white; font-size:12px;">üìÑ PDF</button>
                    </div>
                    <button onclick="document.getElementById('importInput').click()" style="background:#334155; color:white; font-size:12px;">üì• Import Backup File</button><input type="file" id="importInput" style="display:none" onchange="importBackup(event)">
                </div>
                <button style="background:rgba(248, 81, 73, 0.1); color:var(--danger); border:1px solid var(--danger); margin: 20px 0;" onclick="logout()">üö™ Logout</button>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-item active" onclick="nav('home', this)">üè†<br>Home</div>
            <div class="nav-item" onclick="nav('earn', this)">üí∞<br>Earn</div>
            <div class="nav-item" onclick="nav('loan', this)">ü§ù<br>Loan</div>
            <div class="nav-item" onclick="nav('goal', this)">üéØ<br>Goal</div>
            <div class="nav-item" onclick="nav('hist', this)">üìä<br>History</div>
            <div class="nav-item" onclick="nav('acc', this)">üë§<br>Account</div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyB8KrSTL2tjTGdnqKPMdXwXT1y_zVT7-Kw",
        authDomain: "expense-tracker-20.firebaseapp.com",
        projectId: "expense-tracker-20",
        storageBucket: "expense-tracker-20.firebasestorage.app",
        messagingSenderId: "204031122093",
        appId: "1:204031122093:web:04331f17b1fc5fb7ee4424"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let ex = [], ea = [], loans = [], goals = [], wallet = 0, limit = 0, user = {name: "User", photo: "https://via.placeholder.com/80"}, bChart;

    // --- GOOGLE SHEET SYNC FUNCTION ---
    async function sendToSheet(n, a, type) {
        const scriptURL = "https://script.google.com/macros/s/AKfycbyetss9ZJAR89bgYLenFzDeSl68JLQ1WFBxV2qAPrJIsTD8OnIa6a4tntNw0JX-wBmY/exec";
        const payload = { name: n, amount: a, type: type };

        try {
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(payload)
            });
            console.log("Synced with Google Sheet ‚úÖ");
        } catch (e) {
            console.error("Sheet sync failed", e);
        }
    }

    function handleAuth(type) {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(!email || !pass) return alert("Fill all fields");
        if(type === 'login') {
            auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
        } else {
            auth.createUserWithEmailAndPassword(email, pass).then(u => {
                db.collection('users').doc(u.user.uid).set({ex:[], ea:[], loans:[], goals:[], wallet:0, limit:0, user:{name:"User", photo:"https://via.placeholder.com/80"}});
            }).catch(e => alert(e.message));
        }
    }

    function logout() { auth.signOut(); location.reload(); }

    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            db.collection('users').doc(u.uid).onSnapshot(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    ex = data.ex || []; ea = data.ea || []; loans = data.loans || [];
                    goals = data.goals || []; wallet = data.wallet || 0;
                    limit = data.limit || 0; user = data.user || user;
                    updateUI();
                }
            });
        }
    });

    function sync() {
        if(auth.currentUser) {
            db.collection('users').doc(auth.currentUser.uid).set({
                ex, ea, loans, goals, wallet, limit, user
            }, { merge: true });
        }
    }

    function showToast(m) { const c = document.getElementById('toastContainer'); const t = document.createElement('div'); t.className = 'toast'; t.textContent = m; c.appendChild(t); setTimeout(()=>t.classList.add('show'), 10); setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(), 300); }, 2500); }

    function updateUI() {
        let ts = ex.reduce((s,i)=>s+i.a, 0), te = ea.reduce((s,i)=>s+i.a, 0), lT = loans.filter(l=>l.type==='taken'&&l.status==='pending').reduce((s,i)=>s+i.a, 0), lG = loans.filter(l=>l.type==='given'&&l.status==='pending').reduce((s,i)=>s+i.a, 0);
        document.getElementById('walletTotal').innerText = (wallet + te - ts + lT - lG).toLocaleString();
        document.getElementById('budgetLeft').innerText = Math.max(0, limit - ts).toLocaleString() + " TK";
        document.getElementById('hName').innerText = user.name; document.getElementById('hPic').src = user.photo;
        document.getElementById('accDisplayName').innerText = user.name; document.getElementById('accPic').src = user.photo;
        const now = new Date(); const tStr = now.toDateString(); const startM = new Date(now.getFullYear(), now.getMonth(), 1);
        document.getElementById('todaySpend').innerText = ex.filter(t => new Date(t.date).toDateString() === tStr).reduce((s,i)=>s+i.a, 0).toLocaleString();
        document.getElementById('monthSpend').innerText = ex.filter(t => new Date(t.date) >= startM).reduce((s,i)=>s+i.a, 0).toLocaleString();
        document.getElementById('totalSpentHeader').innerText = ts.toLocaleString() + " TK";
        document.getElementById('totalEarnHeader').innerText = te.toLocaleString() + " TK";
        document.getElementById('totalLoanHeader').innerText = (lT - lG).toLocaleString() + " TK";
        if (limit > 0 && ts >= (limit * 0.8)) { document.getElementById('budgetAlert').style.display = 'block'; document.getElementById('budgetAlert').innerText = ts >= limit ? "‚ùå Budget Exceeded!" : "‚ö†Ô∏è 80% Budget Used!"; } else { document.getElementById('budgetAlert').style.display = 'none'; }
        renderChart(te, ts);
    }

    function renderChart(te, ts) { const ctx = document.getElementById('budgetChart').getContext('2d'); if(bChart) bChart.destroy(); bChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Earned', 'Spent'], datasets: [{ data: [te, ts], backgroundColor: ['#238636', '#f85149'], borderWidth: 0 }] }, options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#8b949e', font: { size: 10 } } } } } }); }
    
    function nav(p, el) { 
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active-page')); 
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active')); 
        document.getElementById(p).classList.add('active-page'); el.classList.add('active'); 
        if(p==='hist') renderHist(); if(p==='earn') renderEarn(); if(p==='loan') renderLoans(); if(p==='goal') renderGoals(); 
        if(p==='acc') { document.getElementById('nameIn').value = user.name; document.getElementById('mainBalIn').value = wallet; document.getElementById('limitIn').value = limit; } 
    }

    function addEx() { 
        let n = document.getElementById('exN').value, a = parseFloat(document.getElementById('exA').value); 
        if(!n || isNaN(a)) return; 
        ex.push({id:Date.now(), n, a, date: new Date().toISOString()}); 
        sync(); 
        sendToSheet(n, a, 'expense'); 
        document.getElementById('exN').value=''; 
        document.getElementById('exA').value=''; 
        showToast("Added ‚úÖ"); 
    }

    function addEa() { 
        let n = document.getElementById('eaN').value, a = parseFloat(document.getElementById('eaA').value); 
        if(!n || isNaN(a)) return; 
        ea.push({id:Date.now(), n, a, date: new Date().toISOString()}); 
        sync(); 
        sendToSheet(n, a, 'earn'); 
        renderEarn(); 
        showToast("Income Added üí∞"); 
    }

    function addLoan() { 
        let t = document.getElementById('loanType').value, p = document.getElementById('loanPerson').value, a = parseFloat(document.getElementById('loanAmount').value); 
        if(!p || isNaN(a)) return; 
        loans.push({id:Date.now(), type:t, p, a, status:'pending', date:new Date().toLocaleDateString()}); 
        sync(); 
        sendToSheet(p + " (" + t + ")", a, 'loan'); 
        renderLoans(); 
    }

    function addGoal() { let n = document.getElementById('goalN').value, a = parseFloat(document.getElementById('goalA').value); if(!n || isNaN(a)) return; goals.push({id:Date.now(), n, a}); sync(); renderGoals(); showToast("Goal set! üéØ"); }

    function setMainBal() { 
        wallet = parseFloat(document.getElementById('mainBalIn').value)||0; 
        sync(); 
        sendToSheet("Wallet Sync", wallet, 'wallet_sync'); 
        showToast("Wallet Synced"); 
    }

    function setLimit() { 
        limit = parseFloat(document.getElementById('limitIn').value)||0; 
        sync(); 
        sendToSheet("Budget Update", limit, 'budget_set'); 
        showToast("Budget Updated"); 
    }

    function saveName() { user.name = document.getElementById('nameIn').value || user.name; sync(); showToast("Profile Updated"); }
    function uploadPic(e) { let r = new FileReader(); r.onload = function() { user.photo = r.result; sync(); }; if(e.target.files[0]) r.readAsDataURL(e.target.files[0]); }
    
    function del(t, id) { if(t==='ex') ex=ex.filter(x=>x.id!==id); else ea=ea.filter(x=>x.id!==id); sync(); t==='ex'?renderHist():renderEarn(); }
    function delLoan(id){ loans=loans.filter(x=>x.id!==id); sync(); renderLoans(); }
    function delGoal(id){ goals=goals.filter(x=>x.id!==id); sync(); renderGoals(); }
    function markPaid(id){ let l=loans.find(x=>x.id===id); if(l)l.status='paid'; sync(); renderLoans(); }

    function renderHist() { document.getElementById('histList').innerHTML = ex.slice().reverse().map(i => `<div class="txn-card"><div><b>${i.n}</b><br><small>${new Date(i.date).toLocaleDateString()}</small></div><div style="text-align:right"><b>-${i.a} TK</b><br><span class="del-btn" onclick="del('ex',${i.id})">Delete</span></div></div>`).join(''); }
    function renderEarn() { document.getElementById('earnList').innerHTML = ea.slice().reverse().map(i => `<div class="txn-card" style="border-left-color:var(--earn-color)"><div><b>${i.n}</b><br><small>${new Date(i.date).toLocaleDateString()}</small></div><div style="text-align:right"><b>+${i.a} TK</b><br><span class="del-btn" onclick="del('ea',${i.id})">Delete</span></div></div>`).join(''); }
    function renderLoans() { document.getElementById('loanList').innerHTML = loans.slice().reverse().map(l => `<div class="txn-card" style="border-left-color:var(--loan-color); opacity:${l.status==='paid'?.5:1}"><div><b>${l.p}</b> (${l.type})<br><small>${l.status}</small></div><div style="text-align:right"><b>${l.a} TK</b><br>${l.status==='pending'?`<span class="paid-btn" onclick="markPaid(${l.id})">Paid</span>`:''}<span class="del-btn" onclick="delLoan(${l.id})">Delete</span></div></div>`).join(''); }
    function renderGoals() { let cS = (ea.reduce((s,i)=>s+i.a,0)+wallet)-ex.reduce((s,i)=>s+i.a,0); document.getElementById('goalList').innerHTML = goals.map(g => { let p = Math.min((cS/g.a)*100,100); return `<div class="card-box"><b>${g.n}</b> <span style="float:right">${g.a} TK</span><div style="height:8px; background:#334155; border-radius:10px; margin:10px 0; overflow:hidden;"><div style="width:${p}%; height:100%; background:var(--gold);"></div></div><small>${p.toFixed(1)}% Saved</small><span class="del-btn" style="float:right" onclick="delGoal(${g.id})">Remove</span></div>`; }).join(''); }

    function exportBackup() { let d = { ex, ea, loans, goals, wallet, limit, user }; let b = new Blob([JSON.stringify(d)], { type: "application/json" }); let a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = "ExpensePro_Backup.json"; a.click(); }
    function exportPDF() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text("Expense Pro Report", 20, 20); let y = 30; ex.forEach(i => { doc.text(`${new Date(i.date).toLocaleDateString()}: ${i.n} - ${i.a} TK`, 20, y); y += 10; }); doc.save("Report.pdf"); }
    function toggleMode() { document.body.classList.toggle('light-mode'); }
    </script>
</body>
</html>
